<!DOCTYPE html>
<head>
    <title>Silly Peter Increases G Two - Battle Screen</title>
    <link rel="stylesheet" type="text/css" href="battle-page-style.css" />
</head>
<body>
    <img id="target-icon-1" class="target-icon" src="images/target-icon-1.png"></img>
    <img id="target-icon-2" class="target-icon" src="images/target-icon-2.png"></img>
    <img id="target-icon-3" class="target-icon" src="images/target-icon-3.png"></img>
    <img id="target-icon-4" class="target-icon" src="images/target-icon-4.png"></img>
    <button id="fight-button" onclick="fight()">Fight!</button>
    <div id="battle-log"></div>

    <script>
        let updateBattleLog = function (message) {
            let battleMessage = document.createElement("p");
            battleMessage.style.fontSize = "14px";
            battleMessage.style.textAlign = "left";
            battleMessage.innerHTML = message;
            let battleLog = document.getElementById("battle-log");
            battleLog.appendChild(battleMessage);
        }
    </script>
    <script src="statuses.js"></script>
    <script src="skills.js"></script>
    <script src="items.js"></script>
    <script src="entities.js"></script>
    <script src="dataStorage.js"></script>
    <script src="battleLogic.js"></script>
    <script>
        let gameData = getBattleState();
        if (gameData !== undefined) {
            updatePlayerInfo (gameData.players);
        }
        let enemyIndices = getEncounter();
        for (let i = 0; i < enemyIndices.length; i++) {
            enemies.push(dungeonEnemies[enemyIndices[i]]());
        }

        let createWebsiteElements = function () {
            for (let i = 0; i < players.length; i++) {
                let partyMemberInfo = document.createElement ("div");
                partyMemberInfo.id = "party-member-" + (i + 1) + "-info";
                partyMemberInfo.className = "party-member-info";
                partyMemberInfo.style.left = (10 + 20 * i) + "%";
                document.body.appendChild (partyMemberInfo);

                let partyMemberPortrait = document.createElement ("img");
                partyMemberPortrait.id = "party-member-" + (i + 1) + "-portrait";
                partyMemberPortrait.src = players [i].imagePath;
                partyMemberInfo.appendChild(partyMemberPortrait);

                let partyMemberName = document.createElement ("p");
                partyMemberName.id = "party-member-" + (i + 1) + "-name";
                partyMemberName.innerHTML = "<strong>" + players [i].name [0] + "</strong>" 
                    + players [i].name.slice (1, players [i].name.length);
                partyMemberInfo.appendChild(partyMemberName);

                let partyMemberHP = document.createElement ("p");
                partyMemberHP.id = "party-member-" + (i + 1) + "-hp";
                partyMemberHP.innerHTML = "<span style='color: coral'>" + players [i].health + "</span> HP";
                partyMemberHP.title = players [i].maxHealth + " max HP";
                partyMemberInfo.appendChild(partyMemberHP);

                let partyMemberTarget = document.createElement ("div");
                partyMemberTarget.id = "party-member-" + (i + 1) + "-target";
                partyMemberInfo.appendChild(partyMemberTarget);

                for (let j = 0; j < 4; j++) {
                    let targetButton = document.createElement ("button");
                    targetButton.className = "select-target-button";
                    targetButton.onclick = function () { selectTarget(i, j); };
                    targetButton.innerHTML = (j + 1);
                    partyMemberTarget.appendChild(targetButton);
                }

                let toggleButton = document.createElement ("button");
                toggleButton.id = "toggle-target-" + (i + 1);
                toggleButton.className = "select-target-button";
                toggleButton.onclick = function () { toggleTarget(i) };
                toggleButton.innerHTML = "E";
                toggleButton.title = "Toggle between targeting players/enemies.";
                partyMemberTarget.appendChild(toggleButton);

                for (let j = 0; j < 3; j++) {
                    let moveButton = document.createElement ("button");
                    moveButton.id = "party-" + (i + 1) + "-move-" + (j + 1);
                    moveButton.className = "select-move-button";
                    moveButton.onclick = function () { selectMove (i, j) };
                    if (j < players [i].skills.length) {
                        moveButton.innerHTML = players [i].skills [j].name;
                        moveButton.title = players [i].skills [j].description;
                    } else {
                        moveButton.innerHTML = "-";
                    }
                    partyMemberTarget.appendChild(moveButton);
                }
            }

            for (let i = 0; i < enemies.length; i++) {
                let enemyInfo = document.createElement ("div");
                enemyInfo.id = "enemy-" + (i + 1) + "-info";
                enemyInfo.className = "enemy-info";
                enemyInfo.style.left = (10 + 20 * i) + "%";
                document.body.appendChild (enemyInfo);

                let enemyPortrait = document.createElement ("img");
                enemyPortrait.id = "enemy-" + (i + 1) + "-portrait";
                enemyPortrait.className = "enemy-portrait";
                enemyPortrait.src = enemies [i].imagePath;
                enemyInfo.appendChild(enemyPortrait);

                let enemyName = document.createElement ("p");
                enemyName.id = "enemy-" + (i + 1) + "-name";
                enemyName.innerHTML = "<strong>" + enemies [i].name [0] + "</strong>" 
                    + enemies [i].name.slice (1, enemies [i].name.length);
                enemyInfo.appendChild(enemyName);

                let enemyHP = document.createElement ("p");
                enemyHP.id = "enemy-" + (i + 1) + "-hp";
                enemyHP.innerHTML = "<span style='color: coral'>" + enemies [i].health + "</span> HP";
                enemyHP.title = enemies [i].maxHealth + " max HP";
                enemyInfo.appendChild(enemyHP);
            }
        }

        createWebsiteElements ();
        updateBattleLog ("The enemy draws near!");
    </script>
</body>
</html>